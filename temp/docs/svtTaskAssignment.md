# voa_SvtTaskAssignment Custom API (Task Assignment)

## Purpose
`voa_SvtTaskAssignment` is an **unbound** Dataverse Custom API used by the SVT List PCF control to **assign tasks** to a selected user in the assignment view. The PCF collects selected rows, builds per-task payloads, and calls the API via `Xrm.WebApi.execute`.【F:DetailsListVOA/components/DetailsListHost/DetailsListHost.tsx†L625-L692】【F:DetailsListVOA/services/CustomApi.ts†L23-L73】

The API name is configured in the control config and defaults to `voa_SvtTaskAssignment` for this repo build (overridable via PCF input parameters).【F:DetailsListVOA/config/ControlConfig.ts†L1-L8】【F:DetailsListVOA/components/DetailsListHost/DetailsListHost.tsx†L625-L635】

---

## Client-side flow (PCF)
1. **User opens the assignment panel** and selects tasks.
2. `assignTasksToUser` resolves the API name and custom API type.
3. For each selected task, the PCF calls the Custom API with assignment parameters.
4. On success, the selection is cleared and the grid is refreshed.

Relevant implementation:
- `assignTasksToUser` (builds payloads and calls API).【F:DetailsListVOA/components/DetailsListHost/DetailsListHost.tsx†L637-L692】
- `resolveAssignmentApiName` / `resolveCustomApiTypeForAssign` (config + input parameter).【F:DetailsListVOA/components/DetailsListHost/DetailsListHost.tsx†L625-L635】

---

## Request parameters
The Custom API is called with the following parameters (per selected task):

| Parameter | Type | Notes |
| --- | --- | --- |
| `assignedToUserId` | string | Selected assignee’s Dataverse user ID. | 
| `taskStatus` | string | Task status from the selected record. |
| `saleId` | string | Sale ID from the selected record. |
| `taskId` | string | Task ID from the selected record. **Required** by plugin. |
| `assignedByUserId` | string | Current user ID (from context). |
| `date` | string (ISO) | Assignment timestamp in ISO format. |

The PCF populates these values in `assignTasksToUser` prior to the API call.【F:DetailsListVOA/components/DetailsListHost/DetailsListHost.tsx†L650-L671】

---

## Backend plugin flow (Dataverse → APIM)
The plugin `SvtTaskAssignment`:
1. Reads the API configuration from `voa_CredentialProvider` (`SVTTaskAssignment`).
2. Validates that `assignedToUserId` and `taskId` are present.
3. Posts the assignment payload to APIM as JSON.
4. Returns a `Result` JSON string indicating success or failure.

Relevant files:
- `VOA.SVT.Plugins/Plugins/CustomAPI/SvtTaskAssignment.cs` (core flow, payload, error handling).【F:VOA.SVT.Plugins/Plugins/CustomAPI/SvtTaskAssignment.cs†L12-L172】

---

## Output
The plugin returns a JSON string in the `Result` output parameter, generated by `BuildResult` with:
- `success` (boolean)
- `message` (string)
- `payload` (string)

The plugin sets the `Result` string for both success and failure cases.【F:VOA.SVT.Plugins/Plugins/CustomAPI/SvtTaskAssignment.cs†L118-L162】

---

## Related docs
- `docs/svtGetSaleRecords.md` (search + grid data retrieval).
- `docs/svtGetViewSaleRecordById.md` (sale details retrieval).
- `docs/svtManualTaskCreation.md` (manual task creation endpoint).
